{"version":3,"sources":["../src/baidumap_ctrl.js"],"names":["getColor","orginBili","alpha","bili","one","r","g","b","yellowValue","fullRedValue","darkRedWeight","parseInt","getFilterColor","originOption","styleOption","forEach","keyName","Object","assign","filterCtx","ctx","usePolyOption","sourceOption","getDefaultPolyOption","keyMap","sourceName","targetName","keyValue","getDotRect","mp","lng","lat","squareSize","isCenterPoint","standardLen","xScale","Math","cos","PI","lngDelta","latDelta","pixel","pointToPixel","window","BMap","Point","pixel2","x","y","w","h","strokeWeight","strokeOpacity","strokeColor","fillColor","fillOpacity","isPointInCircle","checkPixel","circlePixel","circleRadius","isPointInRect","sourceCheckRect","checkRect","isPointInPoly","polyPoints","inside","i","j","length","xi","yi","xj","yj","intersect","MetricsPanelCtrl","TimeSeries","kbn","gpsHelper","_","mapRenderer","DataFormatter","decodeGeoHash","panelDefaults","ak","maxDataPoints","theme","initialZoom","autoFocusCenterDistance","valueName","locationData","gpsType","esMetric","decimals","navigation","scale","hideEmpty","overviewMap","hideZero","mapType","traffic","clusterPoint","globalConfig","enableMapClick","typeName","lngName","latName","posName","geohashName","configName","contentName","gpsTypeName","circleName","squareName","polygonName","polylineName","pointName","labelName","bdLabelName","bdPolylineName","bdPolygonName","bdCircleName","bdMarkerName","bdRidingRouteName","bdWalkingRouteName","bdDrivingRouteName","bdHeatRouteName","centerName","maskColor","contentOption","contentTitle","heatCount","heatMax","labelStyle","labelTitle","pointSize","squareLength","isStroke","isFill","markerIcon","markerLabel","markerEnableDragging","markerAnimation","BaidumapCtrl","$scope","$injector","contextSrv","setMapProvider","defaults","panel","dataFormatter","markers","events","on","onInitEditMode","bind","onDataReceived","onPanelTeardown","onDataSnapshotLoad","poiType","getPoiOption","poiConfig","defaultValue","typeOption","getPoiTypeConfig","poiOption","getPoiConfig","poiItem","ctxFields","ctxField","ctxValue","configKey","extJson","JSON","parse","tileServer","setMapSaturationClass","saturationClass","reload","map","snapshotLocationData","locations","jsonUrl","res","refresh","addEditorTab","dataList","dashboard","snapshot","data","setGeohashValues","tableData","tableHandler","setTableValues","tableHandlers","datas","splice","addNode","render","clearOverlays","point","defaultContent","that","e","clickPoint","poiContent","getPoiContent","infoWindow","InfoWindow","openInfoWindow","markerOption","iconUrl","Number","isInteger","icon","Icon","Size","offset","imageOffset","imageSize","anchor","marker","Marker","pointLabel","label","Label","setLabel","push","enableDragging","addEventListener","getPoiInfoWindowHandler","addOverlay","setAnimation","BMAP_ANIMATION_BOUNCE","alert","poiData","getPoiType","sourceGps","sourceGpsId","pointTypeName","poiList","clickHandler","shapeMap","translatePointListMap","Map","callbackList","rawLength","translatedItems","translateCallback","myPoiIndex","myGpsIndex","myGps","translatedData","poiIndex","gpsIndex","gps","sort","a","translateIndex","translatedItem","poiIndexKey","pointItem","shapeList","points","console","log","pointArray","v","pointCollection","PointCollection","getPoiTypeOption","heatPoiType","heatShapeList","heatmapOverlay","BMapLib","HeatmapOverlay","radius","count","setDataSet","max","labelTypeName","labelArray","labelText","labelItem","position","enableMassClear","setStyle","setTitle","markerTypeName","markerArray","addMarker","MarkerClusterer","poiTypeMap","item","pointIndex","driving","renderOptions","autoViewport","search","lastCenterPoint","centerPoint","centerPointCount","centerPointLngTotal","centerPointLatTotal","getDistance","panToCenterPoint","shape","labelPoiTypes","linePoiTypes","dotPoiTypes","canvasTypes","canvasLayerUpdater","canvasLayer","canvas","getContext","matchItems","save","clearRect","width","height","beginPath","fillStyle","fillRect","closePath","restore","getCtxFields","startPoint","moveTo","linePoint","lineTo","stroke","globalAlpha","fill","isCircle","isPoint","layerItem","size","posRect","parseFloat","arc","rect","labelPoint","fillText","canvasLayerPointChecker","checkPoint","reverse","p","some","canvasType","CanvasLayer","paneName","zIndex","update","event","filter","matchItem","translateOne","getMapSourceId","newGps","gpsToBaidu","chinaToBaidu","setTimeout","has","set","get","gpsItem","longitude","latitude","gpsList","split","gpsStr","items","trim","keys","sourceMapId","sourcePointList","convertor","Convertor","groupSize","groupIndex","pointList","translate","result","status","index","error","panTo","o","isNil","value","snapshotData","seriesData","series","datapoints","alias","target","flotpairs","getFlotPairs","nullPointMode","setZoom","setMapStyle","style","document","body","s","getElementsByTagName","len","removeChild","addControl","navigationSwitch","removeControl","scaleSwitch","overviewMapSwitch","mapTypeSwitch","trafficSwitch","stickyLabels","scope","elem","attrs","ctrl","templateUrl"],"mappings":"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","file":"baidumap_ctrl.js","sourcesContent":["/* eslint-disable eqeqeq,id-length,no-inner-declarations,no-plusplus,no-mixed-operators,no-continue,no-nested-ternary */\n/* eslint import/no-extraneous-dependencies: 0 */\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport kbn from 'app/core/utils/kbn';\nimport gpsHelper from './gps_helper';\n\nimport _ from 'lodash';\nimport mapRenderer from './map_renderer';\nimport DataFormatter from './data_formatter';\n\nimport decodeGeoHash from './geohash';\n\nconst panelDefaults = {\n    ak: 'QKCqsdHBbGxBnNbvUwWdUEBjonk7jUj6',\n    maxDataPoints: 1,\n    theme: '',\n    lat: 39.968539,\n    lng: 116.497856,\n    initialZoom: 14,\n    autoFocusCenterDistance: 10000,\n    valueName: 'current',\n    locationData: 'json result',\n    gpsType: 'BD09',\n    esMetric: 'Count',\n    decimals: 0,\n    navigation: true,\n    scale: true,\n    hideEmpty: false,\n    overviewMap: false,\n    hideZero: false,\n    mapType: false,\n    traffic: false,\n    clusterPoint: false,\n    globalConfig: '',\n    enableMapClick: false,\n\n    typeName: 'type',\n    lngName: 'longitude',\n    latName: 'latitude',\n    posName: 'pos',\n    geohashName: 'geohash',\n    configName: 'config',\n    contentName: 'content',\n    gpsTypeName: 'gpsType',\n\n    circleName: 'circle',\n    squareName: 'square',\n    polygonName: 'polygon',\n    polylineName: 'polyline',\n    pointName: 'point',\n    labelName: 'label',\n    bdLabelName: 'Label',\n    bdPolylineName: 'Polyline',\n    bdPolygonName: 'Polygon',\n    bdCircleName: 'Circle',\n    bdMarkerName: 'Marker',\n    bdRidingRouteName: 'RidingRoute',\n    bdWalkingRouteName: 'WalkingRoute',\n    bdDrivingRouteName: 'DrivingRoute',\n    bdHeatRouteName: 'Heat',\n    centerName: 'center',\n    maskColor: '',\n\n    contentOption: 'contentOption',\n    contentTitle: 'contentTitle',\n    heatCount: 'heatCount',\n    heatMax: 'heatMax',\n    labelStyle: 'labelStyle',\n    labelTitle: 'labelTitle',\n    circleRadius: 'radius',\n    pointSize: 'size',\n    squareLength: 'length',\n    fillColor: 'fillColor',\n    isStroke: 'isStroke',\n    isFill: 'isFill',\n    markerIcon: 'markerIcon',\n    markerLabel: 'markerLabel',\n    markerEnableDragging: 'markerEnableDragging',\n    markerAnimation: 'markerAnimation'\n};\n\n\nfunction getColor(orginBili, alpha) {\n    if ((typeof orginBili) !== 'number') {\n        return orginBili;\n    }\n    const bili = orginBili > 100 ? 100 : orginBili;\n    // 百分之一 = (单色值范围) / 50;  单颜色的变化范围只在50%之内\n    const one = (255 + 255) / 100;\n    let r = 0;\n    let g = 0;\n    let b = 0;\n\n    const yellowValue = 50;\n    const fullRedValue = 95;\n    const darkRedWeight = 0.6;\n\n    if (bili <= yellowValue) {\n        // 比例小于yellowValue的时候红色是越来越多的,直到红色为255时(红+绿)变为黄色.\n        r = one * bili / yellowValue * 50;\n        g = 255;\n    } else if (bili > yellowValue && bili <= fullRedValue) {\n        // 比例大于yellowValue的时候绿色是越来越少的,直到fullRedValue 变为纯红\n        g = 255 - ((bili - yellowValue) / (fullRedValue - yellowValue) * 50 * one);\n        r = 255;\n    } else {\n        // 比例大于fullRedValue 开始转为暗红\n        g = 0;\n        r = 255 * (1 - darkRedWeight * (bili - fullRedValue) / (100 - fullRedValue));\n    }\n    r = parseInt(r, 10);// 取整\n    g = parseInt(g, 10);// 取整\n    b = parseInt(b, 10);// 取整\n    return 'rgb(' + r + ',' + g + ',' + b + ',' + alpha + ')';\n}\n\nfunction getFilterColor(originOption) {\n    const styleOption = {};\n    ['fillColor', 'strokeColor'].forEach((keyName) => {\n        if (originOption[keyName]) {\n            styleOption[keyName] = getColor(originOption[keyName], 0.5);\n        }\n    });\n    return Object.assign({}, originOption, styleOption);\n}\n\nfunction filterCtx(ctx, originOption, usePolyOption = true) {\n    const sourceOption = Object.assign(usePolyOption ? getDefaultPolyOption() : {}, originOption);\n    const styleOption = getFilterColor(sourceOption);\n    [\n        ['strokeWeight', 'lineWidth'],\n        ['fillColor', 'fillStyle'],\n        ['strokeColor', 'strokeStyle'],\n        ['strokeOpacity', 'globalAlpha']\n    ].forEach((keyMap) => {\n        const [sourceName, targetName] = keyMap;\n        const keyValue = styleOption[sourceName];\n        delete styleOption[sourceName];\n        styleOption[targetName] = keyValue;\n    });\n    Object.assign(ctx, styleOption);\n}\n\n// 获取色块对应的矩形相对于地图的像素值\nfunction getDotRect(mp, lng, lat, squareSize = 20, isCenterPoint = true) {\n    const standardLen = 111700;\n    const xScale = Math.cos(lat * Math.PI / 180);\n    const lngDelta = squareSize / (standardLen * xScale);\n    const latDelta = squareSize / (standardLen);\n\n    const pixel = mp.pointToPixel(isCenterPoint ? new window.BMap.Point(lng - lngDelta / 2, lat - latDelta / 2) : new window.BMap.Point(lng, lat));\n    const pixel2 = mp.pointToPixel(isCenterPoint ? new window.BMap.Point(lng + lngDelta / 2, lat + latDelta / 2) : new window.BMap.Point(lng + lngDelta, lat + latDelta));\n    return {\n        x: pixel.x,\n        y: pixel.y,\n        w: pixel2.x - pixel.x,\n        h: pixel2.y - pixel.y\n    };\n}\n\n\nfunction getDefaultPolyOption() {\n    return {\n        strokeWeight: 3,\n        strokeOpacity: 0.6,\n        strokeColor: 'blue',\n        fillColor: 'red',\n        fillOpacity: 0.4\n    };\n}\n\nfunction isPointInCircle(checkPixel, circlePixel, circleRadius) {\n    return (checkPixel.x - circlePixel.x) * (checkPixel.x - circlePixel.x)\n        + (checkPixel.y - circlePixel.y) * (checkPixel.y - circlePixel.y)\n        <= circleRadius * circleRadius\n        ;\n}\n\nfunction isPointInRect(checkPixel, sourceCheckRect) {\n    const checkRect = Object.assign({}, sourceCheckRect);\n    if (checkRect.w < 0) {\n        checkRect.x += checkRect.w;\n        checkRect.w *= -1;\n    }\n    if (checkRect.h < 0) {\n        checkRect.y += checkRect.h;\n        checkRect.h *= -1;\n    }\n    return checkPixel.x >= checkRect.x\n        && checkPixel.x <= checkRect.x + checkRect.w\n        && checkPixel.y >= checkRect.y\n        && checkPixel.y <= checkRect.y + checkRect.h;\n}\n\nfunction isPointInPoly(checkPixel, polyPoints) {\n    const x = checkPixel.x;\n    const y = checkPixel.y;\n\n    let inside = false;\n    for (let i = 0, j = polyPoints.length - 1; i < polyPoints.length; j = i++) {\n        const xi = polyPoints[i].x;\n        const yi = polyPoints[i].y;\n        const xj = polyPoints[j].x;\n        const yj = polyPoints[j].y;\n\n        const intersect = ((yi > y) !== (yj > y))\n            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n        if (intersect) {\n            inside = !inside;\n        }\n    }\n    return inside;\n}\n\nexport default class BaidumapCtrl extends MetricsPanelCtrl {\n    constructor($scope, $injector, contextSrv) {\n        super($scope, $injector);\n        this.setMapProvider(contextSrv);\n        _.defaults(this.panel, panelDefaults);\n\n        this.dataFormatter = new DataFormatter(this, kbn);\n        this.markers = [];\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n        this.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\n        // this.loadLocationDataFromFile();\n    }\n\n    getPoiTypeOption(poiType) {\n        return this.getPoiOption(poiType, null);\n    }\n\n    getPoiOption(poiType, poiConfig, defaultValue = {}) {\n        const configName = 'option';\n        const typeOption = this.getPoiTypeConfig(poiType, configName, {});\n        const poiOption = this.getPoiConfig(poiType, poiConfig, configName, {});\n        return Object.assign(defaultValue, typeOption, poiOption);\n    }\n\n    getPoiTypeConfig(poiType, configName, defaultValue = '') {\n        return this.getPoiConfig(poiType, null, configName, defaultValue);\n    }\n\n    getPoiContent(poiType, poiItem, defaultValue = '') {\n        const contentName = this.panel.contentName;\n        return this.getPoiConfig(poiType, poiItem, contentName, defaultValue);\n    }\n\n    getCtxFields(poiType, poiItem){\n        const poiOption = {};\n        const ctxFields = ['strokeWeight', 'fillColor', 'strokeColor', 'strokeOpacity', 'fillOpacity', 'font'];\n        ctxFields.forEach((ctxField)=>{\n            const ctxValue = this.getPoiConfig(poiType, poiItem, ctxField, '');\n            if(ctxValue!=''){\n                poiOption[ctxField] = ctxValue;\n            }\n        });\n        return poiOption;\n    }\n\n    getPoiConfig(poiType, poiItem, configKey, defaultValue = '') {\n        if (!poiType) {\n            return defaultValue;\n        }\n        if (poiItem && configKey in poiItem) {\n            return poiItem[configKey];\n        }\n        const configName = this.panel.configName;\n        if (poiItem && configName in poiItem && poiItem[configName].length > 0) {\n            const extJson = JSON.parse(poiItem[configName]);\n            if (configKey in extJson) {\n                return extJson[configKey];\n            }\n        }\n        if (this.panel.globalConfig && this.panel.globalConfig.length > 0) {\n            const globalConfig = JSON.parse(this.panel.globalConfig);\n            if (poiType in globalConfig && configKey in globalConfig[poiType]) {\n                return globalConfig[poiType][configKey];\n            }\n        }\n        return defaultValue;\n    }\n\n    setMapProvider(contextSrv) {\n//    this.tileServer = contextSrv.user.lightTheme ? 'CartoDB Positron' : 'CartoDB Dark';\n        this.tileServer = 'CartoDB Positron';\n        this.setMapSaturationClass();\n    }\n\n    setMapSaturationClass() {\n        if (this.tileServer === 'CartoDB Dark') {\n            this.saturationClass = 'map-darken';\n        } else {\n            this.saturationClass = '';\n        }\n    }\n\n    loadLocationDataFromFile(reload) {\n        if (this.map && !reload) return;\n\n        if (this.panel.snapshotLocationData) {\n            this.locations = this.panel.snapshotLocationData;\n            return;\n        }\n\n        if (this.panel.locationData === 'jsonp endpoint') {\n\n        } else if (this.panel.locationData === 'json endpoint') {\n            if (!this.panel.jsonUrl) return;\n        } else if (this.panel.locationData === 'table') {\n            // .. Do nothing\n\n        } else if (this.panel.locationData !== 'geohash' && this.panel.locationData !== 'json result') {\n\n        }\n    }\n\n    reloadLocations(res) {\n        this.locations = res;\n        this.refresh();\n    }\n\n    onPanelTeardown() {\n        if (this.map) delete this.map;\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Baidumap', 'public/plugins/grafana-baidumap-panel/partials/editor.html', 2);\n    }\n\n    onDataReceived(dataList) {\n        if (!dataList) return;\n        if (this.dashboard.snapshot && this.locations) {\n            this.panel.snapshotLocationData = this.locations;\n        }\n\n        const data = [];\n        if (this.panel.locationData === 'geohash') {\n            this.dataFormatter.setGeohashValues(dataList, data);\n        } else if (this.panel.locationData === 'table') {\n            const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        } else if (this.panel.locationData === 'json result') {\n            const tableData = dataList.map(DataFormatter.tableHandlers.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        } else {\n            const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        }\n        // const datas = this.filterEmptyAndZeroValues(data);\n\n        const datas = data;\n        if (typeof this.data === 'object') this.data.splice(0, this.data.length);\n        this.markers.splice(0, this.markers.length);\n        if (datas.length) {\n            this.data = datas;\n            this.map ? this.addNode(this.BMap) : this.render();\n        } else {\n            if (this.map) this.map.clearOverlays();\n            this.render();\n        }\n    }\n\n    getPoiInfoWindowHandler(poiType, point, poiItem, defaultContent = '') {\n        const that = this;\n        return (e) => {\n            let clickPoint = point;\n            if (!clickPoint) {\n                clickPoint = e.point;\n            }\n            const poiContent = that.getPoiContent(poiType, poiItem, defaultContent);\n            if (!poiContent) {\n                return;\n            }\n            const infoWindow = new BMap.InfoWindow(poiContent,\n                that.getPoiConfig(poiType, poiItem, that.panel.contentOption, {\n                    'title': that.getPoiConfig(poiType, poiItem, that.panel.contentTitle, clickPoint.lng + '|' + clickPoint.lat)\n                })\n            ); // 创建信息窗口对象\n            that.map.openInfoWindow(infoWindow, clickPoint);\n        };\n    }\n\n    addMarker(poiType, point, BMap, data) {\n\n        // public/plugins/grafana-baidumap-panel/images/bike.png\n        const markerOption = this.getPoiOption(poiType, data);\n        const iconUrl = this.getPoiConfig(poiType, data, this.panel.markerIcon, '');\n        if (Number.isInteger(iconUrl)) {\n            markerOption.icon = new BMap.Icon('https://api.map.baidu.com/img/markers.png', new BMap.Size(23, 25), {\n                offset: new BMap.Size(10, 25), // 指定定位位置\n                imageOffset: new BMap.Size(0, 25 * (10 - (iconUrl % 10)) - 10 * 25) // 设置图片偏移\n            });\n        } else if (iconUrl.length > 0) {\n            markerOption.icon = new BMap.Icon(iconUrl, new window.BMap.Size(24, 28), {\n                imageSize: new window.BMap.Size(24, 28),\n                anchor: new window.BMap.Size(12, 28)\n            });\n        }\n        const marker = new BMap.Marker(point, markerOption);\n        const pointLabel = this.getPoiConfig(poiType, data, this.panel.markerLabel, '');\n        if (pointLabel.length > 0) {\n            const label = new BMap.Label(pointLabel, {offset: new BMap.Size(20, -10)});\n            marker.setLabel(label);\n        }\n        this.markers.push(marker);\n\n        // this.map.setViewport(pointArray);\n        if (this.getPoiConfig(poiType, data, this.panel.markerEnableDragging, false)) {\n            marker.enableDragging();\n        }\n        marker.addEventListener('click', this.getPoiInfoWindowHandler(poiType, point, data));\n\n        this.map.addOverlay(marker);\n        if (this.getPoiConfig(poiType, data, this.panel.markerAnimation, false)) {\n            marker.setAnimation(BMAP_ANIMATION_BOUNCE); // 跳动的动画\n        }\n        marker.addEventListener('dragend', function (e) {\n            alert('当前位置：' + e.point.lng + ', ' + e.point.lat);\n        });\n    }\n\n\n    getMapSourceId(poiData) {\n        const poiType = this.getPoiType(poiData);\n        const sourceGps = this.getPoiConfig(poiType, poiData, this.panel.gpsTypeName, this.panel.gpsType);\n        let sourceGpsId = 5;\n        if (sourceGps === 'WGS84') {\n            sourceGpsId = 1;\n        } else if (sourceGps === 'GCJ02') {\n            sourceGpsId = 3;\n        } else if (sourceGps === 'WGS84OFFLINE') {\n            sourceGpsId = 11;\n        } else if (sourceGps === 'GCJ02OFFLINE') {\n            sourceGpsId = 13;\n        }\n        return sourceGpsId;\n    }\n\n    getPoiType(poiData) {\n        const pointTypeName = this.panel.pointName;\n        return poiData[this.panel.typeName] || pointTypeName;\n    }\n\n    addNode(BMap) {\n        const that = this;\n        const poiList = this.data;\n        this.map.clearOverlays();\n        this.clickHandler = [];\n\n        const shapeMap = [];\n        const translatePointListMap = new Map();\n        const callbackList = [];\n\n        let rawLength = 0;\n        const translatedItems = [];\n\n        function translateCallback(myPoiIndex, myGpsIndex, myGps, translatedData) {\n            const {lng, lat} = translatedData;\n            translatedItems.push({\n                poiIndex: myPoiIndex,\n                gpsIndex: myGpsIndex,\n                point: new BMap.Point(lng, lat),\n                gps: myGps,\n            });\n\n            if (translatedItems.length === rawLength) {\n                translatedItems.sort(function (a, b) {\n                    return ((a.poiIndex - b.poiIndex) * 1000000) + (a.gpsIndex - b.gpsIndex);\n                });\n                for (let translateIndex = 0; translateIndex < translatedItems.length; translateIndex++) {\n                    const translatedItem = translatedItems[translateIndex];\n                    const poiType = that.getPoiType(translatedItem.gps);\n\n                    const poiIndexKey = 'key_' + translatedItem.poiIndex;\n                    const pointItem = translatedItem.point;\n                    if (!(poiType in shapeMap)) {\n                        shapeMap[poiType] = [];\n                    }\n                    const shapeList = shapeMap[poiType];\n                    if (shapeList.length > 0 && shapeList[shapeList.length - 1].poiIndexKey === poiIndexKey) {\n                        shapeList[shapeList.length - 1].points.push(pointItem);\n                    } else {\n                        shapeList.push({\n                            poiIndexKey: poiIndexKey,\n                            poiType: poiType,\n                            poiData: translatedItem.gps,\n                            points: [pointItem]\n                        });\n                    }\n                }\n                console.log('shapeMap', shapeMap);\n\n                const pointTypeName = 'Point';\n                if (shapeMap[pointTypeName]) {\n                    const pointArray = shapeMap[pointTypeName];\n                    const points = [];\n                    pointArray.forEach((v) => {\n                        v.points.forEach((point) => {\n                            point.poiData = v.poiData;\n                            points.push(point);\n                        });\n                    });\n                    const pointCollection = new BMap.PointCollection(points, getFilterColor(that.getPoiTypeOption(pointTypeName)));\n                    pointCollection.addEventListener('click', (e) => {\n                        const poiData = e.point.poiData;\n                        delete e.point[poiData];\n                        that.getPoiInfoWindowHandler(pointTypeName, e.point, poiData)(e);\n                    });\n                    that.map.addOverlay(pointCollection);\n                }\n\n                const heatPoiType = that.panel.bdHeatRouteName;\n                if (shapeMap[heatPoiType]) {\n                    const heatShapeList = shapeMap[heatPoiType];\n                    const heatmapOverlay = new BMapLib.HeatmapOverlay(\n                        Object.assign(\n                            {\n                                radius: 20,\n                            },\n                            that.getPoiTypeOption(heatPoiType)\n                        ));\n                    that.map.addOverlay(heatmapOverlay);\n                    const dataList = [];\n                    heatShapeList.forEach((v) => {\n                        v.points.forEach((point) => {\n                            dataList.push(({\n                                lng: point.lng,\n                                lat: point.lat,\n                                count: that.getPoiConfig(heatPoiType, v.poiData, that.panel.heatCount, 1)\n                            }));\n                        });\n                    });\n                    heatmapOverlay.setDataSet({\n                        data: dataList,\n                        max: that.getPoiTypeConfig(heatPoiType, that.panel.heatMax, 100)\n                    });\n                }\n\n                const labelTypeName = that.panel.bdLabelName;\n                if (shapeMap[labelTypeName]) {\n                    const labelArray = shapeMap[labelTypeName];\n                    labelArray.forEach((v) => {\n                        v.points.forEach((point) => {\n                            const labelText = that.getPoiContent(labelTypeName, v.poiData);\n                            const labelItem = new BMap.Label(labelText, {\n                                position: point,\n                                enableMassClear: true\n                            });\n                            that.map.addOverlay(labelItem);\n                            labelItem.setStyle(that.getPoiConfig(labelTypeName, v.poiData, that.panel.labelStyle, {}));\n                            labelItem.setTitle(that.getPoiConfig(labelTypeName, v.poiData, that.panel.labelTitle, ''));\n                            labelItem.addEventListener('click', that.getPoiInfoWindowHandler(labelTypeName, point, v.poiData));\n                            // that.addlabel(labelTypeName, label, BMap, v.poiData);\n                        });\n                    });\n                }\n                const markerTypeName = that.panel.bdMarkerName;\n                if (shapeMap[markerTypeName]) {\n                    const markerArray = shapeMap[markerTypeName];\n                    markerArray.forEach((v) => {\n                        v.points.forEach((point) => {\n                            that.addMarker(markerTypeName, point, BMap, v.poiData);\n                        });\n                    });\n                    if (that.panel.clusterPoint) {\n                        new BMapLib.MarkerClusterer(that.map, {\n                            markers: that.markers\n                        });\n                    }\n                }\n\n                [that.panel.bdRidingRouteName, that.panel.bdDrivingRouteName, that.panel.bdWalkingRouteName].forEach((poiType) => {\n                    if (poiType in shapeMap) {\n                        const poiTypeMap = {};\n                        poiTypeMap[that.panel.bdRidingRouteName] = 'RidingRoute';\n                        poiTypeMap[that.panel.bdDrivingRouteName] = 'DrivingRoute';\n                        poiTypeMap[that.panel.bdWalkingRouteName] = 'WalkingRoute';\n                        shapeMap[poiType].forEach((item) => {\n                            const points = item.points;\n                            for (let pointIndex = 0; pointIndex < points.length - 1; pointIndex++) {\n                                const driving = new BMap[poiTypeMap[poiType]](that.map, {\n                                    renderOptions: {\n                                        map: that.map,\n                                        autoViewport: false\n                                    }\n                                });\n                                driving.search(points[pointIndex], points[pointIndex + 1]);\n                            }\n                        });\n                    }\n                });\n                const lastCenterPoint = that.centerPoint;\n                let [centerPointCount, centerPointLngTotal, centerPointLatTotal] = [0, 0, 0];\n                [that.panel.centerName].forEach((poiType) => {\n                    if (poiType in shapeMap) {\n                        shapeMap[poiType].forEach((item) => {\n                            item.points.forEach((point) => {\n                                centerPointCount += 1;\n                                centerPointLngTotal += point.lng;\n                                centerPointLatTotal += point.lat;\n                            });\n                        });\n                    }\n                });\n                if (centerPointCount > 0) {\n                    that.centerPoint = new BMap.Point(\n                        centerPointLngTotal / centerPointCount,\n                        centerPointLatTotal / centerPointCount,\n                    );\n                } else {\n                    that.centerPoint = new BMap.Point(that.panel.lng, that.panel.lat);\n                }\n                if (that.panel.autoFocusCenterDistance >= 0\n                    && (!lastCenterPoint || that.map.getDistance(lastCenterPoint, that.centerPoint) > that.panel.autoFocusCenterDistance)) {\n                    that.panToCenterPoint();\n                }\n                [that.panel.bdPolylineName, that.panel.bdPolygonName, that.panel.bdCircleName].forEach((poiType) => {\n                    if (shapeMap[poiType]) {\n                        const poiTypeMap = {};\n                        poiTypeMap[that.panel.bdPolylineName] = 'Polyline';\n                        poiTypeMap[that.panel.bdPolygonName] = 'Polygon';\n                        poiTypeMap[that.panel.bdCircleName] = 'Circle';\n                        shapeMap[poiType].forEach((item) => {\n                            const poiOption = Object.assign(\n                                getDefaultPolyOption(),\n                                getFilterColor(that.getPoiOption(item.poiType, item.poiData))\n                            );\n                            const circleRadius = that.getPoiConfig(item.poiType, item.poiData, that.panel.circleRadius, 20);\n                            if (poiType === that.panel.bdCircleName) {\n                                item.points.forEach((point) => {\n                                    const shape = new BMap[poiTypeMap[poiType]](point, circleRadius, poiOption);\n                                    that.map.addOverlay(shape);\n                                    shape.addEventListener('click', that.getPoiInfoWindowHandler(poiType, point, item.poiData));\n                                });\n                            } else {\n                                const shape = new BMap[poiTypeMap[poiType]](item.points, poiOption);\n                                that.map.addOverlay(shape);\n                                shape.addEventListener('click', that.getPoiInfoWindowHandler(poiType, null, item.poiData));\n                            }\n                        });\n                    }\n                });\n                const labelPoiTypes = [that.panel.labelName];\n                const linePoiTypes = [that.panel.polygonName, that.panel.polylineName];\n                const dotPoiTypes = [that.panel.squareName, that.panel.circleName, that.panel.pointName];\n                const canvasTypes = [...labelPoiTypes, ...dotPoiTypes, ...linePoiTypes];\n\n                const canvasLayerUpdater = (canvasLayer) => {\n                    const ctx = canvasLayer.canvas.getContext('2d');\n                    if (!ctx) {\n                        return [];\n                    }\n                    const matchItems = [];\n                    ctx.save();\n                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                    if (that.panel.maskColor) {\n                        ctx.beginPath();\n                        ctx.fillStyle = that.panel.maskColor;\n                        ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                        ctx.closePath();\n                    }\n                    ctx.restore();\n                    linePoiTypes.forEach((poiType) => {\n                        if (shapeMap[poiType]) {\n                            shapeMap[poiType].forEach((item) => {\n                                ctx.save();\n                                ctx.beginPath();\n                                const poiOption = Object.assign({},\n                                    that.getPoiOption(poiType, item.poiData),\n                                    that.getCtxFields(poiType, item.poiData)\n                                );\n                                filterCtx(ctx, poiOption);\n                                const startPoint = that.map.pointToPixel(item.points[0]);\n                                ctx.moveTo(startPoint.x, startPoint.y);\n                                for (let pointIndex = 1; pointIndex < item.points.length; pointIndex++) {\n                                    const linePoint = that.map.pointToPixel(item.points[pointIndex]);\n                                    ctx.lineTo(linePoint.x, linePoint.y);\n                                }\n                                if (poiType === that.panel.polylineName) {\n                                    ctx.stroke();\n                                } else if (poiType === that.panel.polygonName) {\n                                    ctx.closePath();\n                                    if (that.getPoiConfig(poiType, item.poiData, that.panel.isStroke, true)) {\n                                        ctx.stroke();\n                                    }\n                                    if (poiOption.fillOpacity) {\n                                        ctx.globalAlpha = poiOption.fillOpacity;\n                                    }\n                                    if (that.getPoiConfig(poiType, item.poiData, that.panel.isFill, true)) {\n                                        ctx.fill();\n                                    }\n                                }\n                                ctx.restore();\n                            });\n                        }\n                    });\n                    dotPoiTypes.forEach((poiType) => {\n                        if (shapeMap[poiType]) {\n                            shapeMap[poiType].forEach((item) => {\n                                item.points.forEach((point) => {\n                                    ctx.save();\n                                    const isCircle = poiType === that.panel.circleName;\n                                    const isPoint = poiType === that.panel.pointName;\n                                    const layerItem = {\n                                        lng: point.lng,\n                                        lat: point.lat,\n                                        size: that.getPoiConfig(poiType, item.poiData, that.panel.pointSize, // 优先使用字段size\n                                            that.getPoiConfig(poiType, item.poiData, isCircle ? that.panel.circleRadius :\n                                            (isPoint ? that.panel.pointSize : that.panel.squareLength), isCircle ? 10 :\n                                            (isPoint ? 5 : 20)))\n                                    };\n                                    ctx.beginPath();\n                                    const poiOption = Object.assign({},\n                                        {\n                                            'fillColor': getColor(that.getPoiConfig(poiType, item.poiData, that.panel.fillColor, 'blue'), 0.4)\n                                        },\n                                        that.getPoiOption(poiType, item.poiData),\n                                        that.getCtxFields(poiType, item.poiData)\n                                    );\n                                    filterCtx(ctx, poiOption);\n                                    const posRect = getDotRect(that.map, parseFloat(layerItem.lng),\n                                        parseFloat(layerItem.lat), layerItem.size, !isCircle && !isPoint);\n                                    if (isPoint) {\n                                        ctx.arc(posRect.x, posRect.y, layerItem.size, 0, 2 * Math.PI);\n                                    } else if (isCircle) {\n                                        ctx.arc(posRect.x, posRect.y, posRect.w, 0, 2 * Math.PI);\n                                    } else {\n                                        ctx.rect(posRect.x, posRect.y, posRect.w, posRect.h);\n                                    }\n                                    ctx.closePath();\n                                    if (!isPoint) {\n                                        if (that.getPoiConfig(poiType, item.poiData, that.panel.isStroke, false)) {\n                                            ctx.stroke();\n                                        }\n                                    }\n                                    if (that.getPoiConfig(poiType, item.poiData, that.panel.isFill, true)) {\n                                        ctx.fill();\n                                    }\n                                    ctx.restore();\n                                });\n                            });\n                        }\n                    });\n                    labelPoiTypes.forEach((poiType) => {\n                        if (shapeMap[poiType]) {\n                            shapeMap[poiType].forEach((item) => {\n                                ctx.save();\n                                ctx.beginPath();\n                                const labelText = that.getPoiContent(poiType, item.poiData);\n                                const poiOption = Object.assign({},\n                                    that.getPoiOption(poiType, item.poiData),\n                                    that.getCtxFields(poiType, item.poiData)\n                                );\n                                filterCtx(ctx, poiOption, false);\n                                for (let pointIndex = 0; pointIndex < item.points.length; pointIndex++) {\n                                    ctx.beginPath();\n                                    const labelPoint = that.map.pointToPixel(item.points[pointIndex]);\n                                    ctx.fillText(labelText, labelPoint.x, labelPoint.y);\n                                }\n                                ctx.restore();\n                            });\n                        }\n                    });\n                    return matchItems;\n                };\n\n                const canvasLayerPointChecker = (checkPoint) => {\n                    console.log('check pos: ', checkPoint);\n                    const checkPixel = that.map.pointToPixel(checkPoint);\n                    const matchItems = [];\n                    dotPoiTypes.reverse()\n                        .forEach((poiType) => {\n                            if (shapeMap[poiType]) {\n                                shapeMap[poiType].forEach((item) => {\n                                    item.points.forEach((point) => {\n                                        const isCircle = poiType === that.panel.circleName;\n                                        const isPoint = poiType === that.panel.pointName;\n                                        const layerItem = {\n                                            lng: point.lng,\n                                            lat: point.lat,\n                                            size: that.getPoiConfig(poiType, item.poiData, that.panel.pointSize, // 优先使用字段size\n                                                that.getPoiConfig(poiType, item.poiData, isCircle ? that.panel.circleRadius :\n                                                (isPoint ? that.panel.pointSize : that.panel.squareLength), isCircle ? 10 :\n                                                (isPoint ? 5 : 20)))\n                                        };\n                                        const posRect = getDotRect(that.map, parseFloat(layerItem.lng),\n                                            parseFloat(layerItem.lat), layerItem.size, !isCircle);\n                                        if (isPoint) {\n                                            if (isPointInCircle(checkPixel, posRect, layerItem.size)) {\n                                                matchItems.push([checkPoint, poiType, item.poiData, point]);\n                                            }\n                                        } else if (isCircle) {\n                                            if (isPointInCircle(checkPixel, posRect, posRect.w)) {\n                                                matchItems.push([checkPoint, poiType, item.poiData, point]);\n                                            }\n                                        } else if (isPointInRect(checkPixel, posRect)) {\n                                            matchItems.push([checkPoint, poiType, item.poiData, point]);\n                                        }\n                                    });\n                                });\n                            }\n                        });\n                    linePoiTypes.reverse()\n                        .forEach((poiType) => {\n                            if (shapeMap[poiType]) {\n                                shapeMap[poiType].forEach((item) => {\n                                    if (poiType === that.panel.polygonName\n                                        && isPointInPoly(checkPixel, item.points.map(p => that.map.pointToPixel(p)))\n                                    ) {\n                                        matchItems.push([checkPoint, poiType, item.poiData, item.points]);\n                                    }\n                                });\n                            }\n                        });\n                    console.log('matchItems count:', matchItems.length);\n                    return matchItems;\n                };\n\n                if (canvasTypes.some(canvasType => shapeMap[canvasType]) || that.panel.maskColor) {\n                    const canvasLayer = new BMap.CanvasLayer({\n                        paneName: 'mapPane',\n                        zIndex: -999,\n                        update: function () {\n                            canvasLayerUpdater(this);\n                        }\n                    });\n                    that.map.addOverlay(canvasLayer);\n                    that.clickHandler.push((event) => {\n                        let matchItems = canvasLayerPointChecker(event.point);\n                        matchItems = matchItems.filter(matchItem => that.getPoiContent(matchItem[1], matchItem[2]));\n                        if (matchItems.length > 0) {\n                            const matchItem = matchItems[0];\n                            that.getPoiInfoWindowHandler(matchItem[1], event.point, matchItem[2])(event);\n                        }\n                    });\n                }\n            }\n        }\n\n        function translateOne(poiIndex, gpsIndex, gps) {\n            rawLength += 1;\n            // 转换坐标\n            const sourceGpsId = that.getMapSourceId(gps);\n            if (sourceGpsId > 3) {\n                let newGps = {};\n                if (sourceGpsId === 5) {\n                    newGps = {lng: gps.lng, lat: gps.lat};\n                } else if (sourceGpsId === 11) {\n                    newGps = gpsHelper.gpsToBaidu(gps.lat, gps.lng);\n                } else if (sourceGpsId === 13) {\n                    newGps = gpsHelper.chinaToBaidu(gps.lat, gps.lng);\n                }\n                setTimeout(function () {\n                    translateCallback(poiIndex, gpsIndex, gps, newGps);\n                }, 1);\n            } else {\n                const point = new BMap.Point(gps.lng, gps.lat);\n                if (!translatePointListMap.has(sourceGpsId)) {\n                    translatePointListMap.set(sourceGpsId, []);\n                }\n                translatePointListMap.get(sourceGpsId)\n                    .push(point);\n                callbackList.push(translateCallback.bind(this, poiIndex, gpsIndex, gps));\n            }\n        }\n\n        console.log(poiList);\n        if (poiList) {\n            for (let i = 0; i < poiList.length; i++) {\n                const poiIndex = i;\n                if (poiList[poiIndex] && poiList[poiIndex][that.panel.lngName]\n                    && poiList[poiIndex][that.panel.latName]\n                    && poiList[poiIndex][that.panel.lngName] > 0\n                    && poiList[poiIndex][that.panel.latName] > 0\n                ) {\n                    const gpsItem = Object.assign({}, poiList[poiIndex]);\n                    gpsItem.lng = parseFloat(poiList[poiIndex][that.panel.lngName]);\n                    gpsItem.lat = parseFloat(poiList[poiIndex][that.panel.latName]);\n                    translateOne(poiIndex, 0, gpsItem, BMap);\n                } else if (poiList[poiIndex][that.panel.geohashName] && poiList[poiIndex][that.panel.geohashName].length > 0) {\n                    const {longitude: lng, latitude: lat} = decodeGeoHash(poiList[poiIndex][that.panel.geohashName]);\n                    const gpsItem = Object.assign({}, poiList[poiIndex], {lng, lat});\n                    translateOne(poiIndex, 0, gpsItem, BMap);\n                } else if (poiList[poiIndex][that.panel.posName] && poiList[poiIndex][that.panel.posName].length > 0) {\n                    const gpsList = poiList[poiIndex][that.panel.posName].split(';');\n                    for (let gpsIndex = 0; gpsIndex < gpsList.length; gpsIndex++) {\n                        const gpsStr = gpsList[gpsIndex];\n                        let items = gpsStr.split('|');\n                        if (items.length === 1) {\n                            items = gpsStr.split(',');\n                        }\n                        const [lng, lat] = items;\n                        const gpsItem = Object.assign({}, poiList[poiIndex]);\n                        gpsItem.lng = parseFloat(lng.trim());\n                        gpsItem.lat = parseFloat(lat.trim());\n                        translateOne(poiIndex, gpsIndex, gpsItem, BMap);\n                    }\n                }\n            }\n            for (const sourceMapId of translatePointListMap.keys()) {\n                const sourcePointList = translatePointListMap.get(sourceMapId);\n                if (sourcePointList.length > 0) {\n                    const convertor = new BMap.Convertor();\n                    const groupSize = 10;\n                    for (let groupIndex = 0; groupIndex < sourcePointList.length; groupIndex += groupSize) {\n                        const pointList = [];\n                        for (let pointIndex = 0; pointIndex < groupSize && pointIndex + groupIndex < sourcePointList.length; pointIndex++) {\n                            pointList.push(sourcePointList[groupIndex + pointIndex]);\n                        }\n                        convertor.translate(pointList, sourceMapId, 5, (result) => {\n                            if (result.status === 0) {\n                                for (let index = 0; index < result.points.length; index++) {\n                                    callbackList[groupIndex + index](result.points[index]);\n                                }\n                            } else {\n                                console.error('gps translate error', pointList);\n                            }\n                        });\n                    }\n                }\n            }\n        }\n    }\n\n    panToCenterPoint() {\n        if (this.centerPoint) {\n            this.map.panTo(this.centerPoint);\n        }\n    }\n\n    filterEmptyAndZeroValues(data) {\n        return _.filter(data, (o) => {\n            return !(this.panel.hideEmpty && _.isNil(o.value)) && !(this.panel.hideZero && o.value === 0);\n        });\n    }\n\n    onDataSnapshotLoad(snapshotData) {\n        this.onDataReceived(snapshotData);\n    }\n\n    seriesHandler(seriesData) {\n        const series = new TimeSeries({\n            datapoints: seriesData.datapoints,\n            alias: seriesData.target,\n        });\n\n        series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n        return series;\n    }\n\n    setNewMapCenter() {\n        this.render();\n    }\n\n    setZoom() {\n        this.map.setZoom(parseInt(this.panel.initialZoom, 10) || 1);\n    }\n\n    setStyle() {\n        this.map.setMapStyle({style: this.panel.theme});\n    }\n\n    setAK() {\n        const x = document.body;\n        const s = document.getElementsByTagName('script');\n        const len = s.length;\n        x.removeChild(s[len - 1]);\n        delete this.map;\n        this.render();\n    }\n\n    navigationControl() {\n        if (this.panel.navigation == true) {\n            this.map.addControl(this.navigationSwitch);\n        } else {\n            this.map.removeControl(this.navigationSwitch);\n        }\n    }\n\n    scaleControl() {\n        if (this.panel.scale == true) {\n            this.map.addControl(this.scaleSwitch);\n        } else {\n            this.map.removeControl(this.scaleSwitch);\n        }\n    }\n\n    overviewMapControl() {\n        if (this.panel.overviewMap === true) {\n            this.map.addControl(this.overviewMapSwitch);\n        } else {\n            this.map.removeControl(this.overviewMapSwitch);\n        }\n    }\n\n    mapTypeControl() {\n        if (this.panel.mapType === true) {\n            this.map.addControl(this.mapTypeSwitch);\n        } else {\n            this.map.removeControl(this.mapTypeSwitch);\n        }\n    }\n\n    trafficControl() {\n        if (this.panel.traffic === true) {\n            this.map.addControl(this.trafficSwitch);\n        } else {\n            this.map.removeControl(this.trafficSwitch);\n        }\n    }\n\n    resize() {\n\n    }\n\n    toggleStickyLabels() {\n        console.log(this.panel.stickyLabels);\n    }\n\n    changeLocationData() {\n        if (this.panel.locationData === 'geohash') {\n            this.render();\n        }\n    }\n\n    /* eslint class-methods-use-this: 0 */\n    link(scope, elem, attrs, ctrl) {\n        mapRenderer(scope, elem, attrs, ctrl);\n    }\n\n\n// 如果要调试事件接口，请打开下方屏蔽代码，\n// 在firefox或者chrome下查看调试信息\n\n    // distanceTool.addEventListener('drawend', function (e) {\n    //     console.log('drawend');\n    //     console.log(e.points);\n    //     console.log(e.overlays);\n    //     console.log(e.distance);\n    // });\n    //\n    // distanceTool.addEventListener('addpoint', function (e) {\n    //     console.log('addpoint');\n    //     console.log(e.point);\n    //     console.log(e.pixel);\n    //     console.log(e.index);\n    //     console.log(e.distance);\n    // });\n    //\n    // distanceTool.addEventListener('removepolyline', function (e) {\n    //     console.log('removepolyline');\n    //     console.log(e);\n    // });\n\n}\n\nBaidumapCtrl.templateUrl = 'module.html';\n"]}